#' Generate IGT payoff structure
#' 
#' @param max_trials (integer) The maximum number of trials across all subjects.
#' @param dataset (character) The name of the dataset for simulation.
#' @param payscale (positive real number) Number which true payoffs should be scaled (i.e. divided) by. Defaults to 100.
#' @return all_decks An array with the IGT task structure. 

set_version_igt <- function(max_trials, dataset, payscale) {
  # Initializing deck structure
  deck_A <- deck_B <- deck_C <- deck_D <- array( NA, c(max_trials, 2) ) 
  
  if (dataset %in% c("Horstmann", "Maia", "SteingroverInPrep", "Worthy", "frid_HC", "frid_Cbis")) {
    # For gains
    deck_A[, 1] <- deck_B[, 1] <- 100 # immediate gain of deck_s A and B <- 100
    deck_C[, 1] <- deck_D[, 1] <- 50  # immediate gain of deck_s C and D <- 50
    # For losses
    deck_A[1:max_trials, 2] <- c(0, 0, -150, 0, -300, 0, -200, 0, -250, -350, 
                                 0, -350, 0, -250, -200, 0, -300, -150, 0, 0,  
                                 0, -300, 0, -350, 0, -200, -250, -150, 0, 0,  
                                 -350, -200, -250, 0, 0, 0, -150, -300, 0, 0, 
                                 0, 0, -150, 0, -300, 0, -200, 0, -250, -350,  
                                 0, -350, 0, -250, -200, 0, -300, -150, 0, 0,  
                                 0, -300, 0, -350, 0, -200, -250, -150, 0, 0, 
                                 -350, -200, -250, 0, 0, 0, -150, -300, 0, 0,  
                                 0, 0, -150, 0, -300, 0, -200, 0, -250, -350,  
                                 0, -350, 0, -250, -200, 0, -300, -150, 0, 0)[1:max_trials]
    deck_B[1:max_trials, 2] <- c( rep(0,8), -1250, 0,               
                                  rep(0, 3), -1250, rep(0, 6),     
                                  -1250, rep(0, 9),               
                                  0, -1250, rep(0, 8),
                                  rep(0,8), -1250, 0, 
                                  rep(0, 3), -1250, rep(0, 6),
                                  -1250, rep(0, 9),
                                  0, -1250, rep(0, 8),
                                  rep(0,8), -1250, 0, 
                                  rep(0, 3), -1250, rep(0, 6) )[1:max_trials]
    if (dataset == "Worthy") {
      deck_C[1:max_trials, 2] <- c(0, 0, -50, 0, -50, 0, -50, 0, -50, -50, 
                                   0, -25, -75, 0, 0, 0, -25, -75, -50, 0,
                                   0, 0, 0, -50, -25, -50, 0, 0, -75, -50, 
                                   0, 0, 0, -25, -25, 0, -75, 0, -50, -25, 
                                   0, 0, -50, 0, -50, 0, -50, 0, -50, -50, 
                                   0, -25, -75, 0, 0, 0, -25, -75, -50, 0, 
                                   0, 0, 0, -50, -25, -50, 0, 0, -75, -50, 
                                   0, 0, 0, -25, -25, 0, -75, 0, -50, -25,
                                   0, 0, -50, 0, -50, 0, -50, 0, -50, -50, 
                                   0, -25, -75, 0, 0, 0, -25, -75, -50, 0)[1:max_trials]  
    } else {
      deck_C[1:max_trials, 2] <- c(0, 0, -50, 0, -50, 0, -50, 0, -50, -50,  
                                   0, -25, -75, 0, 0, 0, -25, -75, 0, -50,  
                                   0, 0, 0, -50, -25, -50, 0, 0, -75, -50,  
                                   0, 0, 0, -25, -25, 0, -75, 0, -50, -75, 
                                   0, 0, -50, 0, -50, 0, -50, 0, -50, -50,  
                                   0, -25, -75, 0, 0, 0, -25, -75, 0, -50,  
                                   0, 0, 0, -50, -25, -50, 0, 0, -75, -50,  
                                   0, 0, 0, -25, -25, 0, -75, 0, -50, -75,   
                                   0, 0, -50, 0, -50, 0, -50, 0, -50, -50,  
                                   0, -25, -75, 0, 0, 0, -25, -75, 0, -50)[1:max_trials]  
    }
    deck_D[1:max_trials, 2] <- c( rep(0, 9), -250,                  
                                  rep(0, 9), -250,                  
                                  rep(0, 8), -250, 0,              
                                  rep(0, 4), -250, rep(0, 5),    
                                  rep(0, 9), -250,               
                                  rep(0, 9), -250,               
                                  rep(0, 8), -250, 0,          
                                  rep(0, 4), -250, rep(0, 5),
                                  rep(0, 9), -250,              
                                  rep(0, 9), -250)[1:max_trials]  
  } else if (dataset %in% c("Kjome", "Premkumar", "Wood", "ahn2014_HC", "ahn2014_Amph", "ahn2014_Hero")) {
    # For gains
    deck_A[1:max_trials, 1] <- c(100, 120, 80, 90, 110, 100, 80, 120, 110, 90, 
                                 110, 130, 90, 100, 120, 110, 90, 130, 120, 100, 
                                 120, 140, 110, 110, 100, 120, 130, 110, 140, 120, 
                                 130, 120, 140, 130, 110, 150, 140, 120, 150, 110, 
                                 100, 120, 80, 90, 110, 100, 80, 120, 110, 90, 
                                 110, 130, 90, 100, 120, 110, 90, 130, 120, 100)[1:max_trials] 
    deck_B[1:max_trials, 1] <- c(100, 80, 110, 120, 90, 100, 90, 120, 110, 80, 
                                 110, 100, 90, 130, 120, 130, 110, 90, 100, 120, 
                                 120, 110, 140, 130, 100, 110, 120, 120, 140, 110, 
                                 130, 140, 120, 110, 130, 150, 110, 150, 120, 140, 
                                 140, 150, 130, 120, 140, 160, 120, 160, 130, 150, 
                                 150, 160, 140, 130, 150, 170, 130, 170, 140, 160)[1:max_trials]
    deck_C[1:max_trials, 1] <- c(50, 60, 40, 55, 55, 45, 50, 45, 60, 40, 
                                 55, 55, 65, 45, 70, 40, 50, 60, 70, 40, 
                                 60, 65, 55, 80, 40, 60, 55, 65, 40, 80, 
                                 65, 75, 55, 60, 70, 65, 55, 75, 45, 85, 
                                 70, 80, 60, 65, 75, 70, 60, 80, 50, 90, 
                                 75, 85, 65, 70, 80, 75, 65, 85, 55, 95)[1:max_trials] 
    deck_D[1:max_trials, 1] <- c(50, 40, 45, 45, 55, 60, 40, 55, 50, 60, 
                                 55, 40, 60, 40, 45, 55, 65, 70, 50, 70, 
                                 60, 55, 65, 80, 40, 80, 40, 65, 55, 60, 
                                 65, 75, 60, 65, 75, 85, 45, 55, 70, 55, 
                                 70, 80, 65, 70, 80, 90, 50, 60, 75, 60, 
                                 75, 85, 70, 75, 85, 95, 55, 65, 80, 65)[1:max_trials] 
    # For losses
    deck_A[1:max_trials, 2] <- c(0, 0, -150, 0, -300, 0, -200, 0, -250, -350, 
                                 0, -350, 0, -250, -200, 0, -300, -150, -250, 0, 
                                 -250, -300, 0, -350, 0, -200, -250, -150, -250, 0, 
                                 -350, -200, -250, -250, -150, 0, -150, -300, -350, 0,
                                 0, 0, -150, 0, -300, 0, -200, 0, -250, -350, 
                                 0, -350, 0, -250, -200, 0, -300, -150, -250, 0)[1:max_trials] 
    deck_B[1:max_trials, 2] <- c(0, 0, 0, 0, 0, 0, 0, 0, -1250, 0, 
                                 0, 0, 0, -1500, 0, 0, 0, 0, 0, 0, 
                                 -1750, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                 0, -2000, 0, 0, 0, 0, 0, 0, 0, 0, 
                                 0, 0, 0, 0, 0, -2250, 0, 0, 0, 0, 
                                 0, 0, 0, 0, 0, 0, 0, -2500, 0, 0)[1:max_trials]
    deck_C[1:max_trials, 2] <- c(0, 0, -50, 0, -50, 0, -50, 0, -50, -50, 
                                 0, -25, -75, 0, -25, 0, -25, -75, 0, -50, 
                                 0, -25, 0, -50, -25, -50, 0, -25, -75, -50, 
                                 -25, 0, -25, -25, -25, 0, -75, -25, -50, -75, 
                                 -25, 0, -25, -25, -25, -25, -75, -25, -50, -75, 
                                 -25, -25, -25, -25, -25, -25, -75, -25, -50, -75)[1:max_trials] 
    deck_D[1:max_trials, 2] <- c(0, 0, 0, 0, 0, 0, 0, 0, 0, -250, 
                                 0, 0, 0, 0, 0, 0, 0, 0, 0, -275, 
                                 0, 0, 0, 0, 0, 0, 0, 0, -300, 0, 
                                 0, 0, 0, 0, -325, 0, 0, 0, 0, 0, 
                                 0, 0, 0, 0, -350, 0, 0, 0, 0, 0, 
                                 0, 0, 0, 0, 0, 0, 0, -375, 0, 0)[1:max_trials] 
  }
  # Combine decks into single array and return
  if (dataset %in% c("Horstmann", "SteingroverInPrep")) {
    shuffle <- function(x) {
      resampled <- foreach(i=1:(max_trials/10), .combine = "c") %do% {
        sample(x[,2][((10*i)-9):(10*i)])
      }
      x[,2] <- resampled
      return(x)
    }
    all_decks <- array(c(shuffle(deck_A), shuffle(deck_B), 
                         shuffle(deck_C), shuffle(deck_D)), dim = c(max_trials, 2, 4))
  } else {
    all_decks <- array(c(deck_A, deck_B, deck_C, deck_D), dim = c(max_trials, 2, 4))
  }
  return(all_decks/payscale)
}