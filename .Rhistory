curl -fsSL https://claude.ai/install.sh | bash
install.packages(c("rjags", "coda", "dplyr"))
install.packges("tidyverse")
install.packages("tidyverse")
cd /Users/nielsvaerbak/Desktop/decision_making
install.packages(c('rjags', 'coda', 'dplyr', 'parallel'))
install.packages(c('rjags', 'coda', 'dplyr'))
analysis/scripts/fit_pvl_delta.R
sh analysis/scripts/fit_pvl_delta.R
"analysis/scripts/fit_pvl_delta.R"
source("analysis/scripts/fit_pvl_delta.R")
source("/Users/nielsvaerbak/Desktop/decision_making/analysis/scripts//fit_pvl_delta.R")
source("/Users/nielsvaerbak/Desktop/decision_making/analysis/scripts/fit_pvl_delta.R")
source("/Users/nielsvaerbak/Desktop/decision_making/analysis/scripts/fit_pvl_delta.R")
Rscript analysis/scripts/fit_pvl_delta.R
library(rjags)
library(coda)
# Source utility functions
source("analysis/utils/load_data.R")
# Source utility functions
source("analysis/utils/load_data.R")
source("analysis/utils/prepare_jags_data.R")
getwd()
setwd("/Users/nielsvaerbak/Desktop")
setwd("/Users/nielsvaerbak/Desktop/decision-making")
setwd("/Users/nielsvaerbak/Desktop/decision_making")
# Source utility functions
source("analysis/utils/load_data.R")
source("analysis/utils/prepare_jags_data.R")
# MCMC Settings
config <- list(
n_adapt = 5000,
n_burnin = 10000,
n_iter = 20000,
n_chains = 4,
thin = 2,
rhat_threshold = 1.1,
n_eff_min = 1000,
parameters_to_monitor = c(
# Group-level means
"mu_A",
"mu_alpha",
"mu_cons",
"mu_lambda",
# Group-level variability
"sigma_A",
"sigma_alpha",
"sigma_cons",
"sigma_lambda",
# Subject-level parameters
"A",
"alpha",
"cons",
"lambda"
)
)
# Output settings
output_dir <- "results/pvl_delta"
dir.create(output_dir, recursive = TRUE, showWarnings = FALSE)
message("=== LOADING DATA ===\n")
# Load all IGT data
dat_all <- load_all_igt_data()
# Filter to clinical populations only
clinical_studies <- c("Ahn2014_HC", "Ahn2014_Amph", "Ahn2014_Hero",
"Fridberg2010_HC", "Fridberg2010_Cbis")
dat_clinical <- dat_all[dat_all$study %in% clinical_studies, ]
message(sprintf("Total subjects: %d", length(unique(dat_clinical$subj_unique))))
message(sprintf("Total trials: %d\n", nrow(dat_clinical)))
# Prepare JAGS data
message("=== PREPARING JAGS DATA ===\n")
jags_data <- prepare_jags_data(dat_clinical)
# Validate data
check_jags_data(jags_data)
# Save prepared data
saveRDS(jags_data, file.path(output_dir, "jags_data.rds"))
message(sprintf("\nJAGS data saved to: %s\n", file.path(output_dir, "jags_data.rds")))
message("=== FITTING PVL-DELTA MODEL ===\n")
message("This will take several hours. Progress will be displayed.\n")
# Load JAGS model
model_file <- "analysis/models/pvl_delta_v2.jags"
if (!file.exists(model_file)) {
stop(sprintf("Model file not found: %s", model_file))
}
# Initialize JAGS model
message(sprintf("Initializing model with %d chains...", config$n_chains))
start_time <- Sys.time()
jags_model <- jags.model(
file = model_file,
data = jags_data,
n.chains = config$n_chains,
n.adapt = config$n_adapt,
quiet = FALSE
)
adapt_time <- as.numeric(difftime(Sys.time(), start_time, units = "mins"))
message(sprintf("Adaptation complete (%.1f minutes)", adapt_time))
# Burn-in
message(sprintf("\nBurn-in: %d iterations...", config$n_burnin))
update(jags_model, n.iter = config$n_burnin, progress.bar = "text")
